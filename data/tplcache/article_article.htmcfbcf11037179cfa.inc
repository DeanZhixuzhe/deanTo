<?php
$z[0]=Array("field","",124,143);
$z[0][4]['name']="title";
$z[1]=Array("type","[field:id runphp=\"yes\"]global \$dsql;\$row = \$dsql->GetOne(\"SELECT typename FROM dede_arctype WHERE id = \".@me);if(strpos(\$row['typename'],'求婚')===false){@me='TheOne浪漫策划公司';}else{@me='TheOne求婚策划公司';}[/field:id]",146,405);
$z[2]=Array("field","",446,468);
$z[2][4]['name']="keywords";
$z[3]=Array("field","",508,559);
$z[3][4]['name']="description";
$z[3][4]['function']="html2text(@me)";
$z[4]=Array("global","",593,620);
$z[4][4]['name']="cfg_basehost";
$z[5]=Array("field","\$id=@me;@me='';\$url=GetOneArchive(\$id);@me=\$url['arcurl'];",620,723);
$z[5][4]['name']="id";
$z[5][4]['runphp']="yes";
$z[6]=Array("include","",727,762);
$z[6][4]['filename']="meta.htm";
$z[7]=Array("include","",781,818);
$z[7][4]['filename']="header.htm";
$z[8]=Array("field","",865,894);
$z[8][4]['name']="position";
$z[9]=Array("field","\r\n	global \$dsql;\r\n	\$row = \$dsql->GetOne(\"SELECT keywords FROM dede_archives WHERE title LIKE '%@me%'\");\r\n	\$arr = [\r\n		'地区' => [\r\n			'北京','上海','重庆','天津','成都','昆明','丽江','贵阳','广州','深圳','南宁','海口','三亚','杭州','南京','苏州','合肥','济南','青岛','福州','厦门','南昌','长沙','武汉','郑州','太原','石家庄','沈阳','大连','长春','哈尔滨','西安','香港','巴黎','马尔代夫','巴厘岛','苏梅岛','塞班岛','普吉岛'\r\n		],\r\n		'场景' => [\r\n			'快闪','电影院','咖啡','KTV','酒吧','酒店','餐厅','商场','广场','海边','校园','公园','机场','地铁'\r\n		],\r\n	];\r\n	\$area = '';\r\n	\$scene = '';\r\n	\$connector = '';\r\n	if(strpos(@me,'求婚')!==false or strpos(\$row['keywords'],'求婚')!==false){\r\n		foreach(\$arr as \$k => \$v){\r\n			foreach(\$v as \$val){\r\n				if (strpos(@me,\$val)!==false) {\r\n					switch(\$k){\r\n						case \"地区\":\r\n							\$url = \$dsql->GetOne(\"SELECT filename FROM dede_archives WHERE title LIKE '%{\$val}求婚%' AND channel = -1\");\r\n							if(\$url){\r\n								\$urlstr = str_replace('index','','/proposal/'.\$url['filename']);\r\n								\$area = '<a href=\"'.\$urlstr.'\">'.\$val.'求婚</a>';\r\n							}\r\n							break;\r\n					}\r\n				}\r\n			}\r\n		}\r\n	}\r\n	@me = \$area;\r\n	",894,2224);
$z[9][4]['name']="title";
$z[9][4]['runphp']="yes";
$z[10]=Array("field","",2287,2306);
$z[10][4]['name']="title";
$z[11]=Array("field","",2353,2373);
$z[11][4]['name']="writer";
$z[12]=Array("field","",2395,2451);
$z[12][4]['name']="pubdate";
$z[12][4]['function']="MyDate('Y-m-d H:i',@me)";
$z[13]=Array("field","",2486,2513);
$z[13][4]['name']="phpurl";
$z[14]=Array("field","",2537,2560);
$z[14][4]['name']="id";
$z[15]=Array("field","",2565,2589);
$z[15][4]['name']="mid";
$z[16]=Array("field","",2688,2706);
$z[16][4]['name']="body";
$z[17]=Array("field","\r\nfunction getCon(\$lim,\$nid,\$num=0,\$whereArr,\$len,&\$con){\r\n	global \$dsql;\r\n	\$tid = \"(14,16,17,18,19,20,21,26,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42) AND\";\r\n	\$num++;\r\n	if(\$len == 0){\r\n		for(\$i=0;\$i<count(\$whereArr);\$i++){\r\n			\$wheres .= \"arc.title LIKE '%\$whereArr[\$i]%' OR \";\r\n		}\r\n	}elseif(\$len == -1){\r\n		\$aid = end(explode(',',\$nid));\r\n		\$typeid = \$dsql->GetOne(\"SELECT typeid FROM dede_archives WHERE id = \".\$aid);\r\n		\$tid = \"({\$typeid['typeid']})\";\r\n		\$wheres = \"no\";\r\n	}else{\r\n		for(\$i=0;\$i<\$len;\$i++){\r\n			\$wheres .= \"arc.title LIKE '%\$whereArr[\$i]%' AND \";\r\n		}\r\n	}\r\n	\$len--;\r\n	if(strpos(\$wheres,'AND')!==false){\r\n		\$where = substr(\$wheres,0,strlen(\$wheres)-5);\r\n	}elseif(strpos(\$wheres,'OR')!==false){\r\n		\$where = '('.substr(\$wheres,0,strlen(\$wheres)-4).')';\r\n	}elseif(strpos(\$wheres,'no')!==false){\r\n		\$where = '';\r\n	}else{\r\n		return \$con;\r\n	}\r\n	\$sql = \"SELECT arc.*,tp.typedir,tp.typename,tp.corank,tp.isdefault,tp.defaultname,tp.namerule,tp.namerule2,tp.ispart,tp.moresite,tp.siteurl,tp.sitepath FROM `dede_archives` AS arc LEFT JOIN `dede_arctype` tp ON arc.typeid=tp.id WHERE arc.arcrank>=0 AND arc.typeid IN{\$tid} \$where AND arc.id NOT IN(\$nid) ORDER BY pubdate DESC LIMIT 0,{\$lim}\";\r\n	\$dsql->Execute(\"me{\$num}\", \$sql);\r\n	while (\$row = \$dsql->GetArray(\"me{\$num}\")){\r\n			\$con .= '<li><a href=\"' . GetFileUrl(\$row['id'], \$row['typeid'], \$row['senddate'], \$row['title'], \$row['ismake'], \$row['arcrank'], \$row['namerule'], \$row['typedir'], \$row['money'], \$row['filename'], \$row['moresite'], \$row['siteurl'], \$row['sitepath']) . '\" target=\"_blank\">' . \$row['title'] . '</a></li>';\r\n			\$nids .= \$row['id'].',';\r\n		}\r\n	\$nid = \$nids.\$nid;\r\n	\$total=\$dsql->GetTotalRow(\"me{\$num}\");	//获取查询数量;\r\n	\$lim = \$lim-\$total;\r\n	if(\$lim > 0){\r\n		getCon(\$lim,\$nid,\$num,\$whereArr,\$len,\$con);\r\n	}\r\n	return \$con;\r\n}\r\nfunction related(\$myme){\r\n	global \$dsql;\r\n	\$row = \$dsql->GetOne(\"SELECT * FROM dede_archives WHERE id = {\$myme}\");\r\n	\$arr = [\r\n		'地区' => [\r\n			'北京','上海','重庆','天津','成都','昆明','丽江','贵阳','广州','深圳','南宁','海口','三亚','杭州','南京','苏州','合肥','济南','青岛','福州','厦门','南昌','长沙','武汉','郑州','太原','石家庄','沈阳','大连','长春','哈尔滨','西安','香港','巴黎','马尔代夫','巴厘岛','苏梅岛','塞班岛','普吉岛'\r\n		],\r\n		'分类' => [\r\n			'求婚策划','求婚方式','求婚创意','求婚戒','求婚钻戒','求婚词','求婚歌','求婚音乐'\r\n		],\r\n		'场景' => [\r\n			'快闪','电影院','咖啡','KTV','酒吧','酒店','餐厅','商场','广场','海边','校园','公园','机场','地铁'\r\n		],\r\n		'节日' => [\r\n			'情人节','国庆','圣诞','元旦','春节','光棍'\r\n		],\r\n	];\r\n	if(strpos(\$row['title'],'求婚')!==false or strpos(\$row['keywords'],'求婚')!==false){\r\n		foreach(\$arr as \$k => \$v){\r\n			foreach(\$v as \$val){\r\n				if (strpos(\$row['title'],\$val)!==false) {\r\n					\$whereArr[] .= \$val;\r\n				}\r\n			}\r\n		}\r\n	}\r\n	\$len = count(\$whereArr);\r\n	return getCon(20,\$myme,0,\$whereArr,\$len);\r\n}\r\n	@me = related(@me);\r\n	",2822,5937);
$z[17][4]['name']="id";
$z[17][4]['runphp']="yes";
$z[18]=Array("arclist","\r\n				<li><a href=\"[field:arcurl/]\" target=\"_blank\" rel=\"nofollow\"><img src=\"[field:litpic/]\" title=\"[field:title/]\"><span>[field:title/]</span></a><p>￥[field:trueprice/][field:truepricemax runphp=\"yes\"]if(empty(@me)){@me=\"\";}else{@me=\" - \".@me;}[/field:truepricemax]</p></li>\r\n				",6140,6526);
$z[18][4]['limit']="0,4";
$z[18][4]['channelid']="6";
$z[18][4]['addfields']="trueprice,truepricemax";
$z[18][4]['typeid']="22";
$z[19]=Array("type","\r\n	[field:id runphp=\"yes\"]\r\n		global \$cfg_Cs, \$dsql;\r\n		\$reid = \$dsql->GetOne(\"SELECT reid FROM dede_arctype WHERE id LIKE '%@me%' \");\r\n		if(\$reid['reid'] != 0){\r\n			\$dsql->Execute('mbidss',\"SELECT id FROM dede_arctype WHERE reid LIKE '%\$reid[reid]%' AND id NOT IN(27) AND sortrank < 50\");\r\n		}else{\r\n			\$dsql->Execute('mbidss',\"SELECT id FROM dede_arctype WHERE reid LIKE '%@me%' AND id NOT IN(27)\");\r\n		}\r\n		while (\$mbid = \$dsql->GetArray('mbidss')) {\r\n			\$mbids .= \$mbid['id'] . ',';\r\n		}\r\n		\$mbidsnew = substr(\$mbids,0,strlen(\$mbdis)-1);\r\n		if (\$mbids !='') {\r\n			\$sql = \"SELECT typename,typedir FROM dede_arctype WHERE id IN (\$mbidsnew) ORDER BY id ASC\";\r\n			\$dsql->Execute('me', \$sql);\r\n			while (\$row = \$dsql->GetArray('me')) {\r\n				\$s .= '<li><a href=\"' . str_replace('{cmspath}','',\$row['typedir']) . '/\">' . \$row['typename'] . '</a></li>';\r\n			}\r\n		}\r\n		@me = \$s;\r\n	[/field:id]\r\n",6716,7628);
$z[20]=Array("field","\r\n	\$arr = [\r\n		'一' => [\r\n			'重庆','成都','昆明','丽江','贵阳','南宁'\r\n		],\r\n		'二' => [\r\n			'广州','深圳','海口','三亚','香港','福州','厦门'\r\n		],\r\n		'三' => [\r\n			'杭州','南京','苏州','上海'\r\n		],\r\n		'四' => [\r\n			'南昌','长沙','武汉','合肥'\r\n		],\r\n		'五' => [\r\n			'北京','天津','石家庄','济南','青岛'\r\n		],\r\n		'六' => [\r\n			'西安','太原','郑州'\r\n		],\r\n		'七' => [\r\n			'哈尔滨','长春','沈阳','大连'\r\n		],\r\n		'八' => [\r\n			'巴黎','马尔代夫','巴厘','苏梅','塞班','普吉'\r\n		],\r\n		'场景' => [\r\n			'快闪','电影院','咖啡','KTV','酒吧','酒店','餐厅','商场','广场','海边','校园','公园','机场','地铁'\r\n		],\r\n		'节日' => [\r\n			'圣诞','光棍'\r\n		],\r\n	];\r\n	global \$dsql;\r\n	foreach(\$arr as \$k=>\$v){\r\n		foreach(\$v as \$val){\r\n			if(strpos(@me,\$val)!==false){\r\n				if(\$k != '场景' AND \$k != '节日'){\r\n					\$relName = array_rand(\$v,2);\r\n					foreach(\$relName as \$relVal){\r\n						\$rel = \$dsql->GetOne(\"SELECT * FROM dede_archives WHERE title LIKE '%{\$v[\$relVal]}%' AND channel = -1\");\r\n						if(\$rel){\r\n							\$con .= '<li><a href=\"/proposal/' . str_replace('index','',\$rel['filename']) . '\">' . \$rel['title'] . '</a></li>';\r\n						}\r\n					}\r\n				}else{\r\n					\$relName = array_rand(\$v,2);\r\n					foreach(\$relName as \$relVal){\r\n						\$rel = \$dsql->GetOne(\"SELECT * FROM dede_arctype WHERE typename LIKE '%{\$v[\$relVal]}%求婚%'\");\r\n						if(\$rel){\r\n							\$con .= '<li><a href=\"' . str_replace('{cmspath}','',\$rel['typedir']) . '/\">' . \$rel['typename'] . '</a></li>';\r\n						}\r\n					}\r\n				}\r\n			}\r\n		}\r\n	}\r\n	@me = \$con;\r\n",7630,9313);
$z[20][4]['name']="title";
$z[20][4]['runphp']="yes";
$z[21]=Array("arclist","\r\n				<li><div class=\"piczy_p_l\"><a href=\"[field:arcurl/]\" target=\"_blank\" rel=\"nofollow\"><img src=\"[field:litpic/]\" title=\"[field:title/]\"></a></div><div class=\"piczy_p_r\"><a href=\"[field:arcurl/]\" target=\"_blank\" rel=\"nofollow\">[field:title/]</a><p>¥[field:trueprice/][field:truepricemax runphp=\"yes\"]if(empty(@me)){@me=\"\";}else{@me=\" - \".@me;}[/field:truepricemax]</p></div></li>\r\n				",9462,9953);
$z[21][4]['limit']="0,8";
$z[21][4]['channelid']="6";
$z[21][4]['addfields']="trueprice,truepricemax";
$z[21][4]['typeid']="22";
$z[22]=Array("field","global \$dsql;\r\n				\$sql = \"SELECT arc.*,tp.typedir,tp.typename,tp.corank,tp.isdefault,tp.defaultname,tp.namerule,tp.namerule2,tp.ispart,tp.moresite,tp.siteurl,tp.sitepath FROM `dede_archives` AS arc LEFT JOIN `dede_arctype` tp ON arc.typeid=tp.id WHERE arc.arcrank>=0 AND arc.typeid IN(16,17,18,19,20,21,26,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42) AND arc.id<>@me ORDER BY pubdate DESC LIMIT 0,9\";\r\n				\$dsql->Execute(\"me\", \$sql);\r\n				while (\$row = \$dsql->GetArray(\"me\")){\r\n					\$con .= '<li><a href=\"' . GetFileUrl(\$row['id'], \$row['typeid'], \$row['senddate'], \$row['title'], \$row['ismake'], \$row['arcrank'], \$row['namerule'], \$row['typedir'], \$row['money'], \$row['filename'], \$row['moresite'], \$row['siteurl'], \$row['sitepath']) . '\" target=\"_blank\">' . \$row['title'] . '</a></li>';\r\n				}\r\n				\$sql2 = \"SELECT arc.*,tp.typedir,tp.typename,tp.corank,tp.isdefault,tp.defaultname,tp.namerule,tp.namerule2,tp.ispart,tp.moresite,tp.siteurl,tp.sitepath FROM `dede_archives` AS arc LEFT JOIN `dede_arctype` tp ON arc.typeid=tp.id WHERE arc.arcrank>=0 AND arc.typeid IN(27) AND arc.id<>@me ORDER BY pubdate DESC LIMIT 0,1\";\r\n				\$dsql->Execute(\"news\", \$sql2);\r\n				while (\$row = \$dsql->GetArray(\"news\")){\r\n					\$con .= '<li><a href=\"' . GetFileUrl(\$row['id'], \$row['typeid'], \$row['senddate'], \$row['title'], \$row['ismake'], \$row['arcrank'], \$row['namerule'], \$row['typedir'], \$row['money'], \$row['filename'], \$row['moresite'], \$row['siteurl'], \$row['sitepath']) . '\" target=\"_blank\">' . \$row['title'] . '</a></li>';\r\n				}\r\n				@me = \$con;\r\n				",10076,11667);
$z[22][4]['name']="id";
$z[22][4]['runphp']="yes";
$z[23]=Array("include","",11731,11768);
$z[23][4]['filename']="footer.htm";

?>